<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>מחשבון פיצה</title>
  <!-- חשוב למובייל: בלי זום מוזר, רוחב מסך אמיתי -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <style>
    /* ========= בסיס ========= */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
      color: #222;
      font-size: 16px; /* מונע זום-אין באייפון על אינפוטים */
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding-bottom: 2rem;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.75rem;
      text-align: center;
    }

    /* ========= בלוקים ========= */
    .block {
      background: #fff;
      border-radius: 8px;
      padding: 0.75rem 1rem 1rem;
      margin-bottom: 0.85rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    .block-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.25rem;
    }

    .field {
      margin-bottom: 0.6rem;
    }

    .field label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .radio-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      flex-wrap: wrap;
    }

    /* ========= סטפרים ========= */
    .step-row {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      flex-wrap: wrap;
      direction: ltr; /* ככה מינוס משמאל, פלוס מימין */
    }

    .step-btn {
      padding: 0.2rem 0.6rem;
      min-width: 2.3rem;
      text-align: center;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #fafafa;
      cursor: pointer;
      font-size: 16px; /* חשוב לאייפון */
      user-select: none;
    }

    .step-btn:active {
      background: #e0e0e0;
    }

    .value-display {
      min-width: 3.8rem;
      text-align: center;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      border: 1px solid #ddd;
      background: #fff;
      font-family: monospace;
      font-size: 16px;
    }

    input[type="number"] {
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 5rem;
      font-family: monospace;
      font-size: 16px; /* מונע זום */
    }

    .small-note {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.2rem;
    }

    /* ========= תוצאות ========= */
    .results-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .results-table {
      margin-top: 0.4rem;
      font-size: 0.9rem;
    }

    .results-table div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.15rem;
    }

    details summary {
      cursor: pointer;
      font-size: 0.9rem;
      margin-top: 0.4rem;
      margin-bottom: 0.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>מחשבון פיצה</h1>

    <!-- ========= בלוק 1 – גודל הפיצה ========= -->
    <div class="block" id="block-size">
      <div class="block-title">גודל הפיצה</div>

      <!-- צורה -->
      <div class="field">
        <label>צורה</label>
        <div class="radio-row">
          <label>
            <input type="radio" name="shape" value="round" checked />
            עגולה
          </label>
          <label>
            <input type="radio" name="shape" value="rect" />
            מלבנית
          </label>
        </div>
      </div>

      <!-- קוטר / אורך-רוחב -->
      <div class="field" id="field-diameter">
        <label>קוטר (ס״מ)</label>
        <input type="number" id="diameter" value="30" min="1" step="0.5" />
      </div>

      <div class="field" id="field-rect" style="display:none;">
        <label>אורך × רוחב (ס״מ)</label>
        <div class="row">
          <input type="number" id="length" placeholder="אורך" min="1" step="0.5" />
          <input type="number" id="width" placeholder="רוחב" min="1" step="0.5" />
        </div>
      </div>

      <!-- מספר פיצות -->
      <div class="field">
        <label>מספר פיצות</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="pizzaCount"
               data-step="-1"
               data-min="1"
               data-max="50">–</div>
          <div class="value-display" id="pizzaCount">1</div>
          <div class="step-btn"
               data-target="pizzaCount"
               data-step="1"
               data-min="1"
               data-max="50">+</div>
        </div>
      </div>

      <!-- מצב חישוב -->
      <div class="field">
        <label>מצב חישוב</label>
        <div class="radio-row">
          <label>
            <input type="radio" name="mode" value="thickness" checked />
            קובע עובי ← מקבל משקל
          </label>
        </div>
        <div class="radio-row">
          <label>
            <input type="radio" name="mode" value="weight" />
            קובע משקל לפיצה ← מקבל עובי
          </label>
        </div>
      </div>

      <!-- עובי / משקל לפיצה -->
      <div class="field" id="field-thickness">
        <label>עובי (גרם לס״מ²)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="thickness"
               data-step="-0.1"
               data-min="0"
               data-max="5">––</div>
          <div class="step-btn"
               data-target="thickness"
               data-step="-0.01"
               data-min="0"
               data-max="5">–</div>
          <div class="value-display" id="thickness">0.392</div>
          <div class="step-btn"
               data-target="thickness"
               data-step="0.01"
               data-min="0"
               data-max="5">+</div>
          <div class="step-btn"
               data-target="thickness"
               data-step="0.1"
               data-min="0"
               data-max="5">++</div>
        </div>
        <div class="small-note">
          מבוסס על פיצה עגולה 30 ס״מ במשקל 277 גרם.
        </div>
      </div>

      <div class="field" id="field-dough-per-pizza" style="display:none;">
        <label>משקל בצק לפיצה אחת (גרם)</label>
        <input type="number" id="doughPerPizzaInput" value="277" min="1" step="1" />
      </div>
    </div>

    <!-- ========= בלוק 2 – התפחה ========= -->
    <div class="block" id="block-fermentation">
      <div class="block-title">התפחה</div>

      <div class="field">
        <label>זמן התפחה (שעות)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="hours"
               data-step="-1"
               data-min="3"
               data-max="36">––</div>
          <div class="step-btn"
               data-target="hours"
               data-step="-0.5"
               data-min="3"
               data-max="36">–</div>
          <div class="value-display" id="hours">6.0</div>
          <div class="step-btn"
               data-target="hours"
               data-step="0.5"
               data-min="3"
               data-max="36">+</div>
          <div class="step-btn"
               data-target="hours"
               data-step="1"
               data-min="3"
               data-max="36">++</div>
        </div>
      </div>

      <div class="field">
        <label>טמפרטורה (°C)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="tempC"
               data-step="-0.5"
               data-min="14"
               data-max="30">–</div>
          <div class="value-display" id="tempC">25.0</div>
          <div class="step-btn"
               data-target="tempC"
               data-step="0.5"
               data-min="14"
               data-max="30">+</div>
        </div>
      </div>
    </div>

    <!-- ========= בלוק 3 – פרופיל בצק ========= -->
    <div class="block" id="block-profile">
      <div class="block-title">פרופיל בצק</div>

      <div class="field">
        <label>הידרציה (%)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="hydration"
               data-step="-5"
               data-min="40"
               data-max="90">––</div>
          <div class="step-btn"
               data-target="hydration"
               data-step="-1"
               data-min="40"
               data-max="90">–</div>
          <div class="value-display" id="hydration">60</div>
          <div class="step-btn"
               data-target="hydration"
               data-step="1"
               data-min="40"
               data-max="90">+</div>
          <div class="step-btn"
               data-target="hydration"
               data-step="5"
               data-min="40"
               data-max="90">++</div>
        </div>
      </div>

      <div class="field">
        <label>מלח (%)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="saltPct"
               data-step="-0.1"
               data-min="0"
               data-max="5">–</div>
          <div class="value-display" id="saltPct">2.5</div>
          <div class="step-btn"
               data-target="saltPct"
               data-step="0.1"
               data-min="0"
               data-max="5">+</div>
        </div>
      </div>

      <div class="field">
        <label>שמן (%)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="oilPct"
               data-step="-0.1"
               data-min="0"
               data-max="5">–</div>
          <div class="value-display" id="oilPct">2.0</div>
          <div class="step-btn"
               data-target="oilPct"
               data-step="0.1"
               data-min="0"
               data-max="5">+</div>
        </div>
      </div>

      <div class="field">
        <label>סוכר (%)</label>
        <div class="step-row">
          <div class="step-btn"
               data-target="sugarPct"
               data-step="-0.1"
               data-min="0"
               data-max="5">–</div>
          <div class="value-display" id="sugarPct">1.0</div>
          <div class="step-btn"
               data-target="sugarPct"
               data-step="0.1"
               data-min="0"
               data-max="5">+</div>
        </div>
      </div>
    </div>

    <!-- ========= בלוק 4 – שמרים ========= -->
    <div class="block" id="block-yeast">
      <div class="block-title">שמרים</div>

      <div class="field">
        <label>אחוז שמרים מחושב (% על הקמח)</label>
        <div class="value-display" id="yeastPercentDisplay">0.000%</div>
      </div>

      <details>
        <summary>הגדרות מתקדמות</summary>

        <div class="field">
          <label>סקייל לשמרים</label>
          <div class="step-row">
            <div class="step-btn"
                 data-target="yeastScale"
                 data-step="-0.05"
                 data-min="0.5"
                 data-max="1.5">–</div>
            <div class="value-display" id="yeastScale">1.0</div>
            <div class="step-btn"
                 data-target="yeastScale"
                 data-step="0.05"
                 data-min="0.5"
                 data-max="1.5">+</div>
          </div>
        </div>

        <div class="field">
          <label>
            <input type="checkbox" id="yeastOverrideEnabled" />
            אני רוצה להגדיר אחוז שמרים ידנית
          </label>
        </div>

        <div class="field">
          <label>אחוז שמרים ידני (%)</label>
          <div class="step-row">
            <div class="step-btn"
                 data-target="yeastOverride"
                 data-step="-0.01"
                 data-min="0"
                 data-max="2">–</div>
            <div class="value-display" id="yeastOverride">0.20</div>
            <div class="step-btn"
                 data-target="yeastOverride"
                 data-step="0.01"
                 data-min="0"
                 data-max="2">+</div>
          </div>
        </div>
      </details>
    </div>

    <!-- ========= בלוק 5 – תוצאות ========= -->
    <div class="block" id="block-results">
      <div class="block-title">תוצאות</div>

      <div class="field">
        <div class="results-line">
          <span>משקל בצק לכדור אחד:</span>
          <span id="ballWeightResult">–</span>
        </div>
        <div class="results-line">
          <span>משקל בצק כולל:</span>
          <span id="doughTotalResult">–</span>
        </div>
      </div>

      <div class="results-table">
        <div><span>קמח:</span><span id="flourTotalResult">–</span></div>
        <div><span>מים:</span><span id="waterTotalResult">–</span></div>
        <div><span>מלח:</span><span id="saltTotalResult">–</span></div>
        <div><span>שמן:</span><span id="oilTotalResult">–</span></div>
        <div><span>סוכר:</span><span id="sugarTotalResult">–</span></div>
        <div><span>שמרים:</span><span id="yeastTotalResult">–</span></div>
      </div>
    </div>
  </div>

  <script>
    /* ========= טבלת שמרים ========= */
    const TEMPS = [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];
    const HOURS = [2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 16, 20, 24, 28, 32, 36];

    const YEAST_TABLE = [
      [1.246, 1.112, 0.896, 0.704, 0.576, 0.448, 0.384, 0.32, 0.288, 0.224, 0.167, 0.112, 0.102, 0.079, 0.056, 0.042],
      [1.224, 0.986, 0.832, 0.64, 0.5, 0.384, 0.32, 0.256, 0.224, 0.192, 0.128, 0.099, 0.075, 0.052, 0.048, 0.036],
      [1.112, 0.896, 0.704, 0.512, 0.384, 0.32, 0.256, 0.224, 0.192, 0.16, 0.12, 0.08, 0.052, 0.048, 0.04, 0.03],
      [0.968, 0.768, 0.576, 0.39, 0.32, 0.256, 0.224, 0.192, 0.16, 0.128, 0.099, 0.064, 0.048, 0.04, 0.032, 0.028],
      [0.923, 0.704, 0.512, 0.384, 0.32, 0.234, 0.192, 0.16, 0.144, 0.128, 0.092, 0.056, 0.046, 0.038, 0.031, 0.026],
      [0.896, 0.65, 0.448, 0.32, 0.256, 0.192, 0.16, 0.144, 0.128, 0.096, 0.064, 0.048, 0.043, 0.035, 0.022, 0.018],
      [0.832, 0.576, 0.351, 0.284, 0.192, 0.16, 0.128, 0.112, 0.096, 0.074, 0.052, 0.037, 0.031, 0.024, 0.021, 0.018],
      [0.798, 0.397, 0.284, 0.192, 0.16, 0.128, 0.096, 0.088, 0.08, 0.056, 0.04, 0.034, 0.027, 0.024, 0.021, 0.016],
      [0.448, 0.256, 0.192, 0.16, 0.128, 0.096, 0.08, 0.064, 0.056, 0.048, 0.038, 0.027, 0.023, 0.019, 0.015, 0.011],
      [0.384, 0.224, 0.189, 0.128, 0.096, 0.08, 0.07, 0.06, 0.05, 0.04, 0.028, 0.022, 0.016, 0.015, 0.013, 0.01],
      [0.32, 0.198, 0.176, 0.096, 0.08, 0.064, 0.056, 0.048, 0.04, 0.032, 0.024, 0.016, 0.014, 0.011, 0.01, 0.009],
      [0.256, 0.188, 0.128, 0.096, 0.064, 0.056, 0.048, 0.04, 0.032, 0.025, 0.018, 0.015, 0.011, 0.01, 0.009, 0.008],
      [0.192, 0.128, 0.096, 0.064, 0.056, 0.048, 0.04, 0.032, 0.028, 0.023, 0.017, 0.013, 0.009, 0.008, 0.008, 0.007],
      [0.16, 0.126, 0.094, 0.058, 0.048, 0.04, 0.032, 0.028, 0.024, 0.02, 0.015, 0.009, 0.008, 0.007, 0.006, 0.005],
      [0.128, 0.096, 0.08, 0.053, 0.043, 0.032, 0.028, 0.024, 0.02, 0.016, 0.014, 0.008, 0.006, 0.006, 0.005, 0.004],
      [0.122, 0.09, 0.056, 0.048, 0.04, 0.03, 0.024, 0.021, 0.018, 0.014, 0.01, 0.006, 0.004, 0.005, 0.003, 0.002],
      [0.118, 0.086, 0.048, 0.04, 0.032, 0.024, 0.02, 0.018, 0.016, 0.012, 0.008, 0.006, 0.004, 0.004, 0.003, 0.001]
    ];

    function findBoundingIndices(value, arr) {
      if (value <= arr[0]) return [0, 0];
      const last = arr.length - 1;
      if (value >= arr[last]) return [last, last];
      for (let i = 0; i < arr.length - 1; i++) {
        if (arr[i] <= value && value <= arr[i + 1]) {
          return [i, i + 1];
        }
      }
      return [last, last];
    }

    function interpolateYeastPercent(temp_c, hours) {
      const [tiLow, tiHigh] = findBoundingIndices(temp_c, TEMPS);
      const [hiLow, hiHigh] = findBoundingIndices(hours, HOURS);

      const T_low = TEMPS[tiLow];
      const T_high = TEMPS[tiHigh];
      const H_low = HOURS[hiLow];
      const H_high = HOURS[hiHigh];

      const Q11 = YEAST_TABLE[tiLow][hiLow];
      const Q12 = YEAST_TABLE[tiLow][hiHigh];
      const Q21 = YEAST_TABLE[tiHigh][hiLow];
      const Q22 = YEAST_TABLE[tiHigh][hiHigh];

      const t_ratio = (T_high === T_low) ? 0 : (temp_c - T_low) / (T_high - T_low);
      const h_ratio = (H_high === H_low) ? 0 : (hours - H_low) / (H_high - H_low);

      const V_Tlow = Q11 + (Q12 - Q11) * h_ratio;
      const V_Thigh = Q21 + (Q22 - Q21) * h_ratio;

      const V = V_Tlow + (V_Thigh - V_Tlow) * t_ratio;
      return V;
    }

    function getYeastPercent(temp_c, hours, yeastScale = 1.0, yeastOverride = null) {
      let value;
      if (yeastOverride !== null && !isNaN(yeastOverride)) {
        value = yeastOverride;
      } else {
        const base = interpolateYeastPercent(temp_c, hours);
        value = base * yeastScale;
      }
      if (value < 0.001) value = 0.001;
      if (value > 2.0) value = 2.0;
      return Math.round(value * 1000) / 1000;
    }

    function computePizzaRecipe(state) {
      const {
        shape,
        diameter,
        length,
        width,
        pizzaCount,
        mode,
        thicknessFactor,
        doughPerPizzaInput,
        hours,
        tempC,
        hydrationPct,
        saltPct,
        oilPct,
        sugarPct,
        yeastScale,
        yeastOverridePct
      } = state;

      // 1. שטח
      let areaSingle;
      if (shape === 'round') {
        const radius = diameter / 2;
        areaSingle = Math.PI * radius * radius;
      } else {
        areaSingle = (length || 0) * (width || 0);
      }

      const areaTotal = areaSingle * pizzaCount;

      // 2. עובי / משקל
      let thickness;
      let doughPerPizza;

      if (mode === 'thickness') {
        thickness = thicknessFactor;
        doughPerPizza = areaSingle * thickness;
      } else {
        doughPerPizza = doughPerPizzaInput;
        thickness = doughPerPizza / (areaSingle || 1);
      }

      const doughTotal = doughPerPizza * pizzaCount;
      const ballWeight = doughPerPizza;

      // 3. אחוזים → מרכיבים
      const H = hydrationPct / 100;
      const S = saltPct / 100;
      const O = oilPct / 100;
      const U = sugarPct / 100;

      const factor = 1 + H + S + O + U;

      const flourTotal = doughTotal / factor;
      const waterTotal = flourTotal * H;
      const saltTotal = flourTotal * S;
      const oilTotal = flourTotal * O;
      const sugarTotal = flourTotal * U;

      // 4. שמרים
      const yeastPercent = getYeastPercent(tempC, hours, yeastScale, yeastOverridePct);
      const yeastTotal = flourTotal * (yeastPercent / 100);

      // 5. עיגולים
      const r0 = x => Math.round(x);
      const r1 = x => Math.round(x * 10) / 10;
      const r2 = x => Math.round(x * 100) / 100;
      const r3 = x => Math.round(x * 1000) / 1000;

      return {
        areaSingle,
        areaTotal,
        ballWeight: r1(ballWeight),
        doughTotal: r1(doughTotal),
        thicknessFactor: r3(thickness),

        flourTotal: r0(flourTotal),
        waterTotal: r0(waterTotal),
        saltTotal: r1(saltTotal),
        oilTotal: r1(oilTotal),
        sugarTotal: r1(sugarTotal),

        yeastPercent: r3(yeastPercent),
        yeastTotal: r2(yeastTotal)
      };
    }

    // ========= UI =========

    const debounce = (fn, delay = 180) => {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), delay);
      };
    };

    function getStateFromUI() {
      const shape = document.querySelector('input[name="shape"]:checked').value;
      const mode = document.querySelector('input[name="mode"]:checked').value;

      const diameter = parseFloat(document.getElementById('diameter').value) || 0;
      const length = parseFloat(document.getElementById('length').value) || 0;
      const width = parseFloat(document.getElementById('width').value) || 0;

      const pizzaCount = parseInt(document.getElementById('pizzaCount').textContent, 10) || 1;

      const thickness = parseFloat(document.getElementById('thickness').textContent) || 0.392;
      const doughPerPizzaInput = parseFloat(document.getElementById('doughPerPizzaInput').value) || 0;

      const hours = parseFloat(document.getElementById('hours').textContent) || 6;
      const tempC = parseFloat(document.getElementById('tempC').textContent) || 25;

      const hydration = parseFloat(document.getElementById('hydration').textContent) || 60;
      const saltPct = parseFloat(document.getElementById('saltPct').textContent) || 2.5;
      const oilPct = parseFloat(document.getElementById('oilPct').textContent) || 2.0;
      const sugarPct = parseFloat(document.getElementById('sugarPct').textContent) || 1.0;

      const yeastScale = parseFloat(document.getElementById('yeastScale').textContent) || 1.0;
      const overrideEnabled = document.getElementById('yeastOverrideEnabled').checked;
      const yeastOverrideVal = parseFloat(document.getElementById('yeastOverride').textContent) || 0.2;
      const yeastOverridePct = overrideEnabled ? yeastOverrideVal : null;

      return {
        shape,
        diameter,
        length,
        width,
        pizzaCount,
        mode,
        thicknessFactor: thickness,
        doughPerPizzaInput,
        hours,
        tempC,
        hydrationPct: hydration,
        saltPct,
        oilPct,
        sugarPct,
        yeastScale,
        yeastOverridePct
      };
    }

    function updateVisibility() {
      const shape = document.querySelector('input[name="shape"]:checked').value;
      const mode = document.querySelector('input[name="mode"]:checked').value;

      document.getElementById('field-diameter').style.display =
        shape === 'round' ? 'block' : 'none';
      document.getElementById('field-rect').style.display =
        shape === 'rect' ? 'block' : 'none';

      document.getElementById('field-thickness').style.display =
        mode === 'thickness' ? 'block' : 'none';
      document.getElementById('field-dough-per-pizza').style.display =
        mode === 'weight' ? 'block' : 'none';
    }

    function renderResults(result, state) {
      if (!result) return;

      // בצק
      document.getElementById('ballWeightResult').textContent =
        result.ballWeight + ' גרם';
      document.getElementById('doughTotalResult').textContent =
        result.doughTotal + ' גרם';

      // מרכיבים (סה״כ + אחוזים)
      document.getElementById('flourTotalResult').textContent =
        result.flourTotal + ' גרם';

      document.getElementById('waterTotalResult').textContent =
        result.waterTotal + ' גרם (' + state.hydrationPct.toFixed(0) + '%)';

      document.getElementById('saltTotalResult').textContent =
        result.saltTotal + ' גרם (' + state.saltPct.toFixed(1) + '%)';

      document.getElementById('oilTotalResult').textContent =
        result.oilTotal + ' גרם (' + state.oilPct.toFixed(1) + '%)';

      document.getElementById('sugarTotalResult').textContent =
        result.sugarTotal + ' גרם (' + state.sugarPct.toFixed(1) + '%)';

      document.getElementById('yeastTotalResult').textContent =
        result.yeastTotal + ' גרם (' + result.yeastPercent.toFixed(3) + '%)';

      document.getElementById('yeastPercentDisplay').textContent =
        result.yeastPercent.toFixed(3) + '%';
    }

    const recalc = debounce(() => {
      const state = getStateFromUI();
      const result = computePizzaRecipe(state);
      renderResults(result, state);
    });

    function setupSteppers() {
      const buttons = document.querySelectorAll('.step-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const targetId = btn.dataset.target;
          const step = parseFloat(btn.dataset.step);
          const min = parseFloat(btn.dataset.min);
          const max = parseFloat(btn.dataset.max);

          const valueElem = document.getElementById(targetId);
          if (!valueElem) return;

          let current = parseFloat(valueElem.textContent);
          if (isNaN(current)) current = 0;

          let next = current + step;
          if (!isNaN(min)) next = Math.max(min, next);
          if (!isNaN(max)) next = Math.min(max, next);

          const decimals = (step.toString().split('.')[1] || '').length;
          const factor = Math.pow(10, decimals);
          next = Math.round(next * factor) / factor;

          valueElem.textContent = next.toFixed(decimals);

          recalc();
        });
      });
    }

    function setupRadiosAndInputs() {
      document.querySelectorAll('input[name="shape"]').forEach(r => {
        r.addEventListener('change', () => {
          updateVisibility();
          recalc();
        });
      });
      document.querySelectorAll('input[name="mode"]').forEach(r => {
        r.addEventListener('change', () => {
          updateVisibility();
          recalc();
        });
      });

      ['diameter', 'length', 'width', 'doughPerPizzaInput'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', recalc);
        }
      });

      document.getElementById('yeastOverrideEnabled')
        .addEventListener('change', recalc);
    }

    function init() {
      setupSteppers();
      setupRadiosAndInputs();
      updateVisibility();
      recalc();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
